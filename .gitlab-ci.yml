variables:
  GIT_DEPTH: 1

default:
  image: gitlab-executor:latest
  tags:
    - local-docker-runner

## Global stages
stages:
  - setup
  - build
  - test

setup:
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  cache:
    key: node-cache
    paths:
      - node_modules/
      - .nx/
    key: contract-cache
    paths:
      - packages/contract/lib
  stage: setup
  script:
    - npm install

contract-build:
  cache:
    key: node-cache
    key: contract-cache
  stage: build
  dependencies:
    - setup
  script:
    - npx nx build contract

frontend-build:
  stage: build
  dependencies:
    - setup
  script:
    - npx nx build frontend

contract-test:
  stage: test
  dependencies:
    - setup
  script:
    - npx nx test contract
